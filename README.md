# jwp-shopping-order

# 2단계 구현

## 기능 목록

### 장바구니

- 장바구니 항목들을 주문한다.
    - 장바구니 항목들이 제거된다.
    - 주문이 반환된다.
    - [ ] 주문한 상품 정보가 유효한지 검증한다. (변하지 않았는지)
- 특정 항목에 쿠폰을 적용할 수 있다.

### 장바구니 항목

- 쿠폰을 적용할 수 있다
- 쿠폰 적용 가격을 알 수 있다

### 주문 항목

- 총액을 구할 수 있다
  - 쿠폰이 적용된 가격이다

### 쿠폰

- 쿠폰을 사용해 가격을 할인한다.
    - 할인 정책을 사용해 할인한다.

### 사용자 쿠폰

사용자에게 발급된 실제 쿠폰이다.

- 쿠폰을 사용해 할인된 가격을 알 수 있다
- 사용된 쿠폰은 다시 사용할 수 없다.

### 할인 정책

- 정량, 백분율로 할인 할 수 있다.
- 상품 가격 이상으로 할인할 수 없다.
    - 상품 가격을 0원으로 만든다

### 돈

- 변경해도, 기존 돈은 변하지 않는다.
- 더할 수 있다
- 뺄 수 있다
- 어떤 금액을 빼면 음수인지 알 수 있다.
- 곱할 수 있다
- 백분율을 구한다
    - 소수점 이하는 버린다
    - 백분율은 0이상 100이하이다
- 0 이상이다

## 고민

### 항목이 쿠폰을 사용 vs 쿠폰이 항목을 직접 할인

항목이 아무래도 더 큰 개념인 것 같다.
그래서 항목이 쿠폰을 사용해 본인의 상태를 결정하는 것이 나을 것 같다.

돈은 불변 객체라서 가격을 할인해 반환해도 기존 가격엔 영향을 주지 않는다.
하지만, 쿠폰은 한 번만 사용됨을 보장해야 한다.
그래서 쿠폰은 상태를 가변으로 결정했고, 항목은 불변으로 결정했다.

### 할인 관련 고민

#### 가장 직관적인 플로우를 따르자

1. 사용자의 장바구니 항목에 쿠폰을 적용한다.
2. 사용자는 원하는 장바구니 항목을 주문한다.
3. 쿠폰이 적용된 상태로 주문이 들어간다.

```
다른 개발자가 이해하고, 유지보수하기가 쉽도록 유지하는 것이 목표이기 때문이다.
유연하고 응집도 높게 만들기 위해, 의미를 명확하게 만들기 위해 조금 자원 낭비가 있더라도 괜찮다고 생각한다.
느린 성능은 개선의 여지만 남았다. 앞으로 얼마든지 개선할 수 있다.

하지만 이해하기 어려운 코드는 나 외에 개선할 사람이 없을 뿐 아니라, 
다른 사람의 귀중한 에너지와 시간을 뺏는다고 생각한다.
우리는 협업을 하는 중이고, 성능만 비용이 아니다.
```
#### 실제 가격은 건드리지 않는다.
```
가격은 장바구니 항목이 아니라, 상품에 있다. 
다른 장바구니 항목도 이를 참조하므로 상품을 수정하는 것은 사실 바람직하지 않다.
그 상태로 DB에 저장이라도 된다면? 사고다 사고.

그럼 어떻게 할 것인가?
장바구니 항목에 쿠폰만 쭉쭉 추가한다.
나중에 정말 가격 계산이 필요한 순간 상품 가격에 할인을 때려서 보여주자.
```
